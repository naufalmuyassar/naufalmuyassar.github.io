const Store = [{ id: "8b65-f81", name: "Bodycon poplin shirt", price: 25.5, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Armani Exchange", clothes: ["Jeans", "Polo shirts", "Shirts"], color: ["Blue", "Dark Blue", "Faded Blue", "Faded Blue Destroy", "Faded Pink", "Faded Pink Destroy"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "7r86-t12", name: "Mid-length check mullet dress", price: 20, discount: 20, quantity: 1, stock: 10, sale: ["New in: Clothing", "New in: Summer Collection"], gender: "Women", brand: "Barneys Originals", clothes: ["Dresses"], color: ["Aqua", "Beige", "Blue", "Black", "Brown", "Copper", "Cream", "Gray", "Green", "Pink", "Purple", "Red", "White", "Yellow"], size: ["UK 1", "UK 2", "UK 3"] }, { id: "4c43-d62", name: "High waisted skinny jeans with fading", price: 50.5, discount: 10, quantity: 1, stock: 10, sale: ["New in: Winter Collection"], gender: "Women", brand: "Abercrombie and Fitch", clothes: ["Jeans", "Pants"], color: ["Black", "Grey"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "2d89-s73", name: "High-waisted slim jeans with rips", price: 15.5, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "Bolongaro Trevor", clothes: ["Jeans", "Pants"], color: ["Black", "Blue", "Dark Dark Dark", "Dark Blue", "Dark Extreme", "Faded Black", "Stone", "Stone Destroy", "Teal", "Tan"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "2y89-p44", name: "Crepe coat with pockets", price: 30, discount: 40, quantity: 1, stock: 10, sale: ["New in: Clothing", "New in: Summer Collection"], gender: "Women", brand: "Caterpillar", clothes: ["Jeans", "Pants"], color: ["Faded Black", "Wildcat", "White"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "4r89-y85", name: "Short shirt dress in cotton", price: 16.9, discount: 10, quantity: 1, stock: 10, sale: ["New in: Winter Collection"], gender: "Women", brand: "Menswear London", clothes: ["Dresses", "Shirts"], color: ["Black", "Black Extreme", "Blue Sky", "Dark", "Dark Grey", "Green", "Grey", "Kaki", "Navy", "Orange", "White", "Wildcat"], size: ["UK 1", "UK 2", "UK 3"] }, { id: "8u10-z86", name: "Selected slim jeans", price: 9.99, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Jack & Jones", clothes: ["Pants"], color: ["Black", "Grey", "Maroon", "Lime", "White"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "777-r77", name: "Military style coat", price: 190, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Leviâ€™s", clothes: ["Jackets & Coats"], color: ["Black", "Grey", "Maroon", "Olive", "White"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5", "UK 6", "UK 7", "UK 8", "UK 9", "UK 10"] }, { id: "9i19-z02", name: "Selected straight jeans", price: 120, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Jeepers Peepers", clothes: ["Chinos", "Jeans", "Pants"], color: ["Blue", "Blue Faded", "Blue Light", "Clear", "Dark Blue", "Faded Gold", "Gold", "Light Salmon", "Silver"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "1e18-o92", name: "Selected cotton and cashmere blend knit sweater", price: 89, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Lacoste", clothes: ["Pulls"], color: ["Blue", "Dark Blue", "Faded Blue", "Faded Blue destroy", "Navy"], size: ["UK 3", "UK 4", "UK 5", "UK 6", "UK 7"] }, { id: "1r45-o78", name: "Military style coat", price: 499, discount: 50, quantity: 1, stock: 10, sale: ["New in: Winter Collection"], gender: "Women", brand: "New Look", clothes: ["Jackets & Coats"], color: ["Clear", "Gold", "Multi", "Cream", "No Color", "Orange", "Silver"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2z45-p98", name: "Long sleeve shirt and pattern", price: 290, discount: 30, quantity: 1, stock: 10, gender: "Women", brand: "Quiksilver", sale: ["New in: Winter Collection"], clothes: ["T-Shirts & Tanks"], color: ["Clear", "Dark Grey", "Dark Salmon", "Fuchsia", "Gold", "Multi", "Cream", "No Color", "Orange", "Silver"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2r11-n54", name: "Reversible cotton short babydoll dress", price: 199, discount: 30, quantity: 1, stock: 10, sale: ["New in: Clothing", "New in: Summer Collection"], gender: "Men", brand: "Shelby & Sons", clothes: ["Dresses"], color: ["Clear", "Green", "Grey", "Kaki", "Orange", "Pink", "Purple", "Red"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2b11-m59", name: "Missguided Bodycon Dress with High Neck", price: 40, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "The Couture Club", clothes: ["Dresses", "Plus Size"], color: ["Black", "Dark Grey", "Grey", "Light Grey", "White"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2t51-o77", name: "Jean pretty little thing", price: 30.9, discount: 10, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "Uncommon Souls", clothes: ["Pants & Split Pants", "Plus Size"], color: ["Faded Blue", "Faded Blue Destroy", "Blue", "Navy", "Black", "Dark grey"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2h81-p97", name: "Noisy May Curve knitted midi cardigan", price: 42, discount: 10, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Uncommon Souls", clothes: ["Jumpers & Cardigans"], color: ["Faded Blue", "Faded Blue Destroy", "Blue", "Blue Sky", "Navy", "Black", "Dark grey", "Orange"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2c01-b99", name: "Wrap shirt noisy dress at the waist", price: 380, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Men", brand: "Wrangler", clothes: ["T-shirts & Shorts"], color: ["Faded Blue", "Faded Blue Destroy", "Blue", "Blue Sky", "Navy", "Black", "Dark grey", "Orange"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "9b01-b99", name: "Organic fabric half-zip sweatshirt", price: 569.9, discount: 30, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "Wrangler", clothes: ["Sweats", "Hoodies & Sweatshirts"], color: ["Faded Blue", "Faded Blue Destroy", "Faded Blue", "Clear", "Dark Blue", "Faded Gold", "Gold", "Sliver Destroy"], size: ["UK 0", "UK 1", "UK 2", "UK 3", "UK 4", "UK 5"] }, { id: "2o02-p97", name: "Faux fur coat with leopard pattern", price: 450, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "Jeepers Peepers", clothes: ["Suits & Tailoring", "Tracksuits"], color: ["Faded Blue", "Faded Blue Destroy", "Faded Blue", "Clear", "Dark Blue", "Faded Gold", "Gold", "Sliver Destroy", "Clear", "Dark Blue", "Faded Gold", "Gold", "Sliver Destroy", "No Color"], size: ["UK 6", "UK 8", "UK 10"] }, { id: "9z01-w86", name: "Slim with exposed button fastening", price: 420, discount: 0, quantity: 1, stock: 10, sale: [], gender: "Women", brand: "The Couture Club", clothes: ["Underwear & Socks"], color: ["Faded Blue", "Faded Blue Destroy", "Faded Blue", "Clear", "Dark Blue", "Faded Gold", "Gold", "Sliver Destroy", "Clear", "Dark Blue", "Faded Gold", "Gold", "Sliver Destroy", "No Color"], size: ["UK 6", "UK 8", "UK 10"] }];

new Vue({
  el: '#app',
  data() {
    return {
      Store: [],
      expand: {
        height: 0 },

      filters: {
        genders: {},
        sales: {},
        clothing: {},
        colors: {},
        sizes: {},
        brands: {},
        prices: 0 },

      menus: {
        genders: false,
        sales: false,
        clothing: false,
        colors: false,
        sizes: false,
        brands: false,
        prices: false },

      range: {
        min: 0,
        max: 500 },

      carts: [],
      cart: false };

  },
  computed: {
    activeMenu() {
      return Object.keys(this.menus).reduce((menu, set, i) => this.menus[set] ? i : menu, -1);
    },
    activeFilters() {
      let { genders, clothing, colors, brands, sales, sizes } = this.filters;
      return {
        genders: Object.keys(genders).filter(g => genders[g]),
        clothing: Object.keys(clothing).filter(c => clothing[c]),
        colors: Object.keys(colors).filter(c => colors[c]),
        brands: Object.keys(brands).filter(b => brands[b]),
        sales: Object.keys(sales).filter(s => sales[s]),
        sizes: Object.keys(sizes).filter(s => sizes[s]),
        prices: this.filters.prices > this.range.min ? [this.filters.prices] : [] };

    },
    list() {
      let { genders, clothing, colors, brands, sales, sizes } = this.activeFilters;
      return this.store.filter(({ gender, clothes, color, brand, sale, size, price, discount }) => {
        let discountPrice = price - price * (discount / 100);
        if (discountPrice < this.filters.prices) return false;
        if (genders.length && !~genders.indexOf(gender)) return false;
        return !clothing.length && !colors.length && !brands.length && !sales.length && !sizes.length ||
        clothing.every(c => ~clothes.indexOf(c)) &&
        colors.every(c => ~color.indexOf(c)) &&
        brands.every(b => ~brand.indexOf(b)) &&
        sales.every(s => ~sale.indexOf(s)) &&
        sizes.every(s => ~size.indexOf(s));
      });
    },
    total() {
      let total = 0;
      this.carts.forEach(p => {
        let discountPrice = p.price - p.price * p.discount / 100;
        total += discountPrice * p.quantity;
      });
      return total;
    } },

  watch: {
    activeMenu(index, from) {
      if (index === from) return;
      this.$nextTick(_ => {
        if (!this.$refs.menu || !this.$refs.menu[index]) {
          this.expand.height = 0;
        } else {
          this.expand.height = `${this.$refs.menu[index].clientHeight}px`;
        }
      });
    } },

  methods: {
    setFilter(filter, option) {
      if (filter === 'genders') {
        this.filters[filter][option] = !this.filters[filter][option];
      } else {
        setTimeout(() => {
          this.clearFilter(filter, option, this.filters[filter][option]);
        }, 100);
      }
    },
    clearFilter(filter, except, active) {
      if (filter === 'prices') {
        this.filters[filter] = this.range.min;
      } else {
        Object.keys(this.filters[filter]).forEach(option => {
          this.filters[filter][option] = except === option && !active;
        });
      }
    },
    clearAllFilters() {
      Object.keys(this.filters).forEach(this.clearFilter);
    },
    setMenu(menu, active) {
      Object.keys(this.menus).forEach(tab => {
        this.menus[tab] = !active && tab === menu;
      });
    },
    addToCart(product) {
      if (product.quantity > product.stock - 1) return;
      let productInCart = this.carts.filter(p => p.id === product.id);
      let isProductInCart = productInCart.length > 0;
      if (isProductInCart === false) {
        this.carts.push(product);
      } else {
        product.quantity++;
      }
    },
    removeFromCart(product) {
      this.carts.splice(this.carts.findIndex(v => v.id === product.id), 1);
      product.quantity = 0;
    },
    resize() {
      let { clientHeight } = document.querySelector('.nav-list.active') || 0;
      this.expand.height = clientHeight;
    } },

  mounted() {
    this.$nextTick(() => {
      window.addEventListener('resize', this.resize);
      this.resize();
    });
  },
  beforeMount() {
    this.store = Store;
    Store.forEach(({ gender, clothes, color, brand, sale, size, price, discount }) => {
      this.$set(this.filters.genders, gender, false);
      clothes.forEach(c => {
        this.$set(this.filters.clothing, c, false);
      });
      color.forEach(c => {
        this.$set(this.filters.colors, c, false);
      });
      this.$set(this.filters.brands, brand, false);
      sale.forEach(s => {
        this.$set(this.filters.sales, s, false);
      });
      size.forEach(s => {
        this.$set(this.filters.sizes, s, false);
      });
      let discountPrice = price - price * discount / 100;
      if (this.range.max < discountPrice) this.range.max = discountPrice;
      if (this.range.min > discountPrice) {
        this.range.min = discountPrice;
        this.$set(this.filters.prices, discountPrice, false);
      }
    });
  } });